## Auzre SQL Database Service

* SQL Database is a genreal purpose relational database managed service in Azure.
* Supports structres such as relational data, JSON, spatial, and XML
* Dynamimcally Scalable performance
* Columnstore indexes for extream analytic analysis and reporting (Data Warehousing) and real time operational analytics

SQL Database types:
* managed Single SQL databases
* managed SQL databases in an elastic pool
* managed SQL Instances (SQL Database Managed Instance - preview) with near 100% compatibility with SQL server on-prem

Availability Capabilities
* 99.99% availability SLA
* Automatic Backups
* Point-in-time restores
* Active geo-replication
* Failover groups
* Zone redundant databases (preview)

Built-in Intelligence
* Automatic Performance monitoring and tuning - performance tuning recomendations and Intelligent Insights
* Automatic tuning - Azure SQL Database identifies CREATE INDEX, DROP INDEX, and FORCE LAST GOOD PLAN recommendations that can optimize the database and shows them in Azure portal

### Scaling out with Azure SQL Database[^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-scale-introduction)
Elastic Database features
* Elastic Database client library [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-database-client-library) -  is used to manage a shard set.
* Elastic Database split-merge tool [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-scale-overview-split-and-merge) - is used to move data from one shard to another
* Elastic Database jobs (preview) [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-jobs-overview) - runs scheduled or ad hoc T-SQL scripts against all databases
* Elastic Database query (preview) [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-query-overview) - allows you to write a query that spans all databases in the shard set
* Elastic transactions [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-transactions-overview) - allow you to run transactions that span several databases.

* Horizontal scaling / "scaling out" - using sharding,  managed using Elastic Database client library
* Verticle scaling / "scaling up"  - using Azure powershell to change serivce tier or placing in elastic pool

**Sharding** is a technique to distribute large amounts of identically structured data across a number of independent databases.

Multi-tenant and Single-tenant sharding patterns.

### SQL Database Security

Protect Data:

* Data in motion - Transport layer security
* Data at rest - Tranparent data encryption
* Data in use - Always encripted
* column-level encryption, or cell-level encryption. 

Data Discovery & Classification (preview) [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-data-discovery-and-classification) - provides capabilities for discovering, classifying, labeling and protecting the sensitive data.

Control Access
* Firewall and Firewall rules
* Authentication ( SQL Authentication and Azure active directory authentication)
* Authorization - database role memberships and object-level permissions
* Row-level security (RLS) [^](https://docs.microsoft.com/en-us/sql/relational-databases/security/row-level-security) based on group membership or execution context
* Dynamic data masking limits sensitive data exposure by masking it to non-privileged users

Proactive monitoring
* Auditing - records database events to Azure storage account
* Threat Detection - detects unusual and potentially harmful attempts to access or exploit databases

SQL Vulnerability Assessment[^](https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment)
* SQL Vulnerability Assessment (VA) is a service that provides visibility into your security state, and includes actionable steps to resolve security issues, and enhance your database security
* Compliance reports generated by VA scans

Business Continuity Features[^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-business-continuity)
* Recovery Time Objective (RTO) - the maximum acceptable time before the application fully recovers after the disruptive event.
* Recovery point objective (RPO) - the maximum amount of recent data updates (time interval) the application can tolerate losing when recovering after the disruptive event

Comparision of ERT and RTO for the common scenarios

|||||
|:--|:--|:--|:--|
| Capability | Basic tier | Standard tier | Premium tier |
|Point in Time Restore from backup|Any restore point within 7 days|Any restore point within 35 days|Any restore point within 35 days|
|Geo-restore from geo-replicated backups|ERT < 12h, RPO < 1h|ERT < 12h, RPO < 1h|ERT < 12h, RPO < 1h|
|Restore from Azure Backup Vault|ERT < 12h, RPO < 1 wk|ERT < 12h, RPO < 1 wk|ERT < 12h, RPO < 1 wk|
|Active geo-replication|ERT < 30s, RPO < 5s|ERT < 30s, RPO < 5s|ERT < 30s, RPO < 5s|
|||||


Database Backups
* SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every five - ten minutes to protect your business from data loss
*  Backups are stored in geo-redundant storage for 35 days for databases in the Standard and Premium service tiers and 7 days for databases in the Basic service tier
* The full and differential database backups are also replicated to a paired data center for protection against a data center outage.
* Long term retention (LTR policy) upto 10 years using Azure Recovery Services vault [^](https://docs.microsoft.com/en-us/azure/sql-database/sql-database-long-term-retention)

Frequency of data backups
* Full database backups happen weekly
* Differential database backups generally happen every few hours
* Transaction log backups generally happen every 5 - 10 minutes

Backup retention period
* Basic service tier is 7 days.
* Standard service tier is 35 days.
* Premium service tier is 35 days.

Data Encryption at rest
* Transparent data encryption with Bring your own key support (TDE with BYOK) [^](https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption-byok-azure-sql)
